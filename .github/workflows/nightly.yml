# This workflow takes care of creating nightly release archives for the
# GAP distribution. It works by tagging the latest master branch as "nightly"
# which then triggers the regular release workflow. Doing it this way ensures
# that everything is as close as possible to a regular release.
name: "Nightly releases"

on:
  workflow_dispatch:
  schedule:
    # Every day at 3:33 AM UTC
    - cron: '39 3 * * *'

jobs:
  nightly:
    runs-on: ubuntu-latest
    steps:
      #- uses: dev-drprasad/delete-tag-and-release@v1.0
      #  with:
      #    tag_name: nightly
      #    github_token: ${{ secrets.GITHUB_TOKEN }}

      - uses: actions/checkout@v4

      # We set up a GitHub App in order to ensure that workflows are run on the PRs
      # created by us, following the instructions here:
      # <https://github.com/peter-evans/create-pull-request/blob/main/docs/concepts-guidelines.md#authenticating-with-github-app-generated-tokens>
      # The bot can also be set up for personal forks of this repository, for testing
      # and debugging, see <https://github.com/apps/gap-package-distribution-bot>.
      - uses: tibdex/github-app-token@v1
        id: generate-token
        with:
          app_id: ${{ secrets.APP_ID }}
          private_key: ${{ secrets.APP_PRIVATE_KEY }}

      - uses: rickstaa/action-create-tag@v1
        id: "tag_create"
        with:
          github_token: ${{ steps.generate-token.outputs.token }}
          tag: "nightly"
          force_push_tag: true
          message: "Nightly build"


