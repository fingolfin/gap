= The GAP build system

This file is meant to give an overview of how the GAP build system works. It
is targeted at people who need to work on the build system itself (to extend
it, fixes bugs in it, etc.). It should not be necessary to read this if all
you want to do is compile GAP and work on the GAP library and kernel.

Note that this really is just an overview; for details, please refer to the
comments inside the various parts of the build system.


== Prerequisites

In order to work on the build system, you need at least the following:

* GNU autoconf (we recommend 2.69 or later)
* GNU libtool (we recommend 2.4.2 or later)
* GNU make

Note that we extensively use features provided by GNU make, so in general
another version of make, such as BSD make, is not suitable.


== Overview of the files constituting the GAP build system

* `autogen.sh`: sets up the build system; typically the first thing to run in
  a fresh clone of the GAP repository. It runs `autoreconf` which in turn runs
  several tools include `aclocal`, `autoheader`, `autoconf`, `libtoolize`

* `configure`: generated by `autogen.sh` from `configure.ac`. 

* `configure.ac`: the GNU autoconf source of our configure script.

* `GNUmakefile`, `GNUmakefile.in`: The former file is generated from the
  latter by `configure`. It is the primary Makefile (GNU make prefers it
  over `Makefile`). It only contains variables and vpath settings, and
  includes `Makefile.rules` for the actual build rules.

* `Makefile`: This is a placeholder file, and serves two purposes:
   1. If the user runs `make` before `configure`, it prints a warning.
   2. If `configure` did ru, but `make` is not GNU make, it 

* `Makefile.rules`: This is the core of the build system.

* `bin/`: This directory is created for compatibility mode (see below)

* `cnf/`: All files in this directory are part of the build system.

* `extern/`: External libraries we bundle with GAP (such as GMP) are
  put in here.

* `gen/`: Generated code (such as `config.h` and `gap_version.c`) is put
  into this directory.

* `obj/`: All `*.o` files are placed into this directory.


== Out-of-tree builds

TODO: explain this in contrast to in-tree builds
TODO: in particular, explain use of `vpath`


== Compatibility mode

Compatibility mode emulates the build environment of the old GAP build system
in order to allow packages with kernel extensions to be used with the new
build system unmodified. As such, it mainly exists to ease the transition
between new and old build system, and the plan is to remove it once all
packages have been adapted to the new build system

Compatibility mode does the following things:

* create a `sysinfo.gap` file in the build dir
* create a `bin/$GAPARCH/config.h` symlink pointing at `gen/config.h`
* for out-of-tree builds, it creates a `${builddir}/src/compiled.h` file
* ... TODO ...


== Dependency tracking

TODO: explain how we implement dependency tracking (perhaps document it in `Makefile.rules`)

